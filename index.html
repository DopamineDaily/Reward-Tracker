<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dopamine Rewards Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --accent: #4a90e2;
      --bg: #f7f8fa;
      --surface: #fff;
      --text: #23272f;
      --text-secondary: #737a86;
      --border: #e0e2e6;
      --shadow: 0 2px 16px rgba(44,62,80,0.06);
      --radius: 16px;
      --checked: #4a90e2;
      --checked-bg: #eaf4fb;
      --transition: 0.16s cubic-bezier(.4,2,.6,1);
    }
    html, body { background: var(--bg); margin: 0; padding: 0; font-family: system-ui,sans-serif; color: var(--text);}
    .container {
      max-width: 490px;
      margin: 30px auto;
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 26px 16px 20px 16px;
      box-sizing: border-box;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: -1px;
      color: var(--text);
      margin-bottom: 0;
    }
    .subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 18px;
      font-size: 1.02rem;
    }
    .mood-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 16px;
    }
    .mood-prompt {
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 7px;
      font-size: 1.05rem;
    }
    .mood-btns {
      display: flex;
      gap: 7px;
    }
    .mood-btn {
      background: #f6fafd;
      border: 1.5px solid var(--border);
      border-radius: 50%;
      font-size: 1.22rem;
      width: 38px; height: 38px;
      cursor: pointer;
      transition: background 0.16s, border 0.16s, transform 0.13s;
      color: var(--text-secondary);
      outline: none;
      box-shadow: 0 1px 4px #4a90e20a;
      display: flex; align-items: center; justify-content: center;
    }
    .mood-btn.selected {
      background: var(--checked-bg);
      border-color: var(--checked);
      color: var(--checked);
      transform: scale(1.13);
    }
    .statsbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 20px;
      justify-content: space-between;
      align-items: center;
      background: var(--accent);
      color: #fff;
      border-radius: var(--radius);
      padding: 13px 15px 11px 15px;
      margin-bottom: 15px;
      font-size: 1.02rem;
      font-weight: 500;
      box-shadow: 0 1.5px 6px #4a90e208;
    }
    .statsbar span {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .progress-bar {
      width: 100%;
      background: #e7e9ec;
      border-radius: 8px;
      overflow: hidden;
      height: 12px;
      margin-bottom: 18px;
      margin-top: 6px;
    }
    .progress {
      background: linear-gradient(90deg, #4a90e2 80%, #8ec9f8 100%);
      height: 100%;
      border-radius: 8px;
      transition: width var(--transition);
    }
    .category {
      margin-bottom: 32px;
    }
    .cat-title {
      font-size: 1.11rem;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--text);
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    ul.rewards-list {
      list-style: none;
      padding: 0; margin: 0;
    }
    .reward-item {
      display: flex;
      align-items: center;
      gap: 13px;
      padding: 10px 0 10px 0;
      border-bottom: 1px solid var(--border);
      transition: background 0.13s;
      position: relative;
    }
    .reward-item:last-child { border-bottom: none; }
    .reward-checkbox {
      width: 22px; height: 22px;
      border-radius: 7px;
      border: 2px solid var(--border);
      background: #fafafc;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: border-color var(--transition), background var(--transition), box-shadow var(--transition), transform 0.11s;
      box-shadow: 0 0.5px 3px #4a90e20c;
      position: relative;
      flex-shrink: 0;
    }
    .reward-checkbox.checked {
      border-color: var(--checked);
      background: var(--checked-bg);
      box-shadow: 0 0 0 3px #eaf4fb;
      animation: reward-bounce 0.15s;
      color: var(--checked);
    }
    @keyframes reward-bounce {
      0% { transform: scale(0.7);}
      70% { transform: scale(1.16);}
      100% { transform: scale(1);}
    }
    .reward-checkbox svg {
      display: none;
      width: 15px; height: 15px;
      stroke: var(--checked);
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .reward-checkbox.checked svg { display: block; }
    .reward-label {
      flex: 1;
      font-size: 1rem;
      color: var(--text);
      user-select: none;
      cursor: pointer;
      transition: color 0.18s;
    }
    .reward-checkbox.checked + .reward-label {
      color: var(--checked);
      text-decoration: line-through;
      opacity: 0.7;
    }
    .remove-reward-btn {
      border: none;
      background: none;
      color: #b03c3c;
      font-size: 1.1em;
      cursor: pointer;
      margin-left: 8px;
      opacity: 0.65;
      transition: color 0.18s, opacity 0.12s;
    }
    .remove-reward-btn:hover { color: #e53e3e; opacity: 1;}
    .add-reward {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    .add-reward input {
      flex: 1;
      padding: 7px;
      border-radius: 7px;
      border: 1.5px solid var(--border);
      font-size: 1rem;
      background: #fafafc;
      outline: none;
      transition: border-color 0.13s;
    }
    .add-reward input:focus { border-color: var(--accent);}
    .add-reward button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 7px 15px;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.14s, transform 0.1s;
    }
    .add-reward button:active { transform: scale(1.09);}
    .add-reward button:hover { background: #357abd; }
    .activity-log {
      margin: 32px 0 0 0;
    }
    .activity-log-title {
      font-weight: 700;
      font-size: 1.07rem;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }
    .log-entry {
      background: #f9fafb;
      border-radius: 7px;
      padding: 10px 13px;
      margin-bottom: 10px;
      border-left: 3.5px solid var(--accent);
      font-size: 0.97rem;
      color: var(--text);
      box-shadow: 0 1px 4px #4a90e20d;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .log-time {
      color: var(--text-secondary);
      font-size: 0.86em;
    }
    .reset-btn {
      margin: 28px 0 0 0;
      width: 100%;
      background: #e0e2e6;
      color: #b03c3c;
      border: none;
      border-radius: 8px;
      padding: 10px 0;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.14s;
    }
    .reset-btn:hover { background: #f5eaea; }
    .celebrate {
      display: none;
      text-align: center;
      font-size: 1.13rem;
      background: #eaf4fb;
      color: #4a90e2;
      border-radius: 10px;
      padding: 10px 0 8px 0;
      font-weight: 700;
      margin-bottom: 13px;
      animation: pop-celebrate 0.7s;
    }
    @keyframes pop-celebrate {
      0% { transform: scale(0.4);}
      80% { transform: scale(1.08);}
      100% { transform: scale(1);}
    }
    .export-import-bar {
      display: flex; gap: 8px; margin-top: 14px; justify-content: flex-end;
    }
    .export-btn, .import-btn {
      background: #f9fafb;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 12px;
      color: var(--accent);
      font-size: 0.97em;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.1s, border 0.13s;
    }
    .export-btn:hover, .import-btn:hover { border-color: var(--accent); background: #eaf4fb;}
    @media (max-width: 600px) {
      .container { max-width: 99vw; padding: 12px 2px;}
      h1 { font-size: 1.19rem;}
      .statsbar { font-size: 0.98rem;}
      .cat-title { font-size: 0.97rem;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="mood-section">
      <div class="mood-prompt">How's your mood?</div>
      <div class="mood-btns">
        <button class="mood-btn" data-mood="üòä" aria-label="Great">üòä</button>
        <button class="mood-btn" data-mood="üôÇ" aria-label="Good">üôÇ</button>
        <button class="mood-btn" data-mood="üòê" aria-label="Meh">üòê</button>
        <button class="mood-btn" data-mood="üòï" aria-label="Low">üòï</button>
        <button class="mood-btn" data-mood="üòû" aria-label="Rough">üòû</button>
      </div>
    </div>
    <h1>Dopamine Rewards Tracker</h1>
    <div class="subtitle">Build momentum with small rewards and positive habits.</div>
    <div class="statsbar">
      <span><b>Today</b>: <span id="stat-today">0</span></span>
      <span><b>Week Avg</b>: <span id="stat-week">0</span></span>
      <span><b>Streak</b>: <span id="stat-streak">0</span></span>
      <span><b>Mood</b>: <span id="stat-mood">-</span></span>
    </div>
    <div id="celebrate" class="celebrate">üéâ All rewards complete! üéâ</div>
    <div class="progress-bar" aria-label="Progress">
      <div class="progress" id="progress-bar" style="width:0%"></div>
    </div>
    <div id="categories"></div>
    <div class="activity-log">
      <div class="activity-log-title">Recent Activity</div>
      <div id="activityLog"></div>
      <button class="reset-btn" onclick="resetDaily()">Reset Today's Progress</button>
      <div class="export-import-bar">
        <button class="export-btn" onclick="exportData()">Export</button>
        <label class="import-btn" style="cursor:pointer;">
          Import <input type="file" style="display:none" onchange="importData(event)">
        </label>
      </div>
    </div>
  </div>
  <script>
    // --- Categories and Defaults ---
    const defaultCategories = [
      {
        name: "Quick Wins",
        emoji: "‚ö°",
        rewards: [
          "Play a short song clip",
          "Open a window, breathe fresh air",
          "Drink water or a favorite beverage",
          "Send a meme or emoji to a friend",
          "Cross off a small to-do",
          "Stretch for one minute"
        ]
      },
      {
        name: "Low-Energy Boosts",
        emoji: "üåô",
        rewards: [
          "Watch a calming video",
          "Wrap up in a blanket",
          "Sip something warm, do nothing else",
          "Doodle or scribble",
          "Listen to ambient sounds",
          "Lay down for 3 minutes, no phone"
        ]
      },
      {
        name: "Big Boosts",
        emoji: "üî•",
        rewards: [
          "Take a 20-min walk",
          "Watch a favorite episode",
          "Order a special snack",
          "Start a cozy game or hobby",
          "Plan a mini-outing",
          "Try a creative project"
        ]
      }
    ];

    // --- State Management ---
    let appState = JSON.parse(localStorage.getItem('dopamine-state') || 'null') || {
      categories: JSON.parse(JSON.stringify(defaultCategories)),
      checked: {},
      mood: null,
      activity: [],
      dailyStats: {}, // { date: count }
    };

    // --- Mood Tracker ---
    document.querySelectorAll('.mood-btn').forEach(btn => {
      btn.onclick = function() {
        if (appState.mood !== btn.dataset.mood) {
          appState.mood = btn.dataset.mood;
          appState.activity.unshift({
            reward: `Mood set to ${btn.dataset.mood}`,
            category: 'Mood',
            time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
          });
          saveAndRender();
        }
      }
    });

    // --- Categories and Rewards Rendering ---
    function renderCategories() {
      const categoriesDiv = document.getElementById('categories');
      categoriesDiv.innerHTML = '';
      appState.categories.forEach((cat, cIdx) => {
        const catDiv = document.createElement('div');
        catDiv.className = 'category';
        const title = document.createElement('div');
        title.className = 'cat-title';
        title.innerHTML = `<span>${cat.emoji}</span> ${cat.name}`;
        catDiv.appendChild(title);

        const ul = document.createElement('ul');
        ul.className = 'rewards-list';

        cat.rewards.forEach((reward, rIdx) => {
          const key = `cat${cIdx}-rew${rIdx}`;
          const li = document.createElement('li');
          li.className = 'reward-item';

          const box = document.createElement('div');
          box.className = 'reward-checkbox';
          box.setAttribute('tabindex', 0);
          box.setAttribute('role', 'checkbox');
          box.setAttribute('aria-checked', !!appState.checked[key]);
          box.dataset.cat = cIdx;
          box.dataset.rew = rIdx;
          if (appState.checked[key]) box.classList.add('checked');
          box.innerHTML = `
            <svg viewBox="0 0 18 18">
              <polyline points="4 10 8 14 14 5" fill="none"/>
            </svg>
          `;
          box.onclick = () => toggleReward(cIdx, rIdx, reward, cat.name);
          box.onkeydown = (e) => {
            if (e.key === " " || e.key === "Enter") toggleReward(cIdx, rIdx, reward, cat.name);
          };

          const label = document.createElement('span');
          label.className = 'reward-label';
          label.textContent = reward;
          label.onclick = () => toggleReward(cIdx, rIdx, reward, cat.name);

          li.appendChild(box);
          li.appendChild(label);

          // Remove button for custom rewards only
          const isCustom = cIdx < defaultCategories.length && rIdx >= defaultCategories[cIdx].rewards.length
                        || cIdx >= defaultCategories.length;
          if (isCustom) {
            const removeBtn = document.createElement('button');
            removeBtn.textContent = '√ó';
            removeBtn.className = 'remove-reward-btn';
            removeBtn.title = 'Remove this custom reward';
            removeBtn.onclick = (e) => {
              e.stopPropagation();
              appState.categories[cIdx].rewards.splice(rIdx, 1);
              delete appState.checked[key];
              saveAndRender();
            };
            li.appendChild(removeBtn);
          }
          ul.appendChild(li);
        });

        // Add custom reward input
        const addDiv = document.createElement('div');
        addDiv.className = 'add-reward';
        const input = document.createElement('input');
        input.type = "text";
        input.placeholder = "Add a custom reward...";
        input.maxLength = 40;
        input.setAttribute('aria-label', 'Custom reward');
        const btn = document.createElement('button');
        btn.textContent = "+";
        btn.onclick = () => {
          const val = input.value.trim();
          if (val) {
            appState.categories[cIdx].rewards.push(val);
            saveAndRender();
            input.value = '';
          }
        };
        input.onkeydown = (e) => { if (e.key === "Enter") btn.click(); };
        addDiv.appendChild(input);
        addDiv.appendChild(btn);
        catDiv.appendChild(ul);
        catDiv.appendChild(addDiv);
        categoriesDiv.appendChild(catDiv);
      });
    }

    // --- Reward Toggle ---
    function toggleReward(cIdx, rIdx, rewardText, catName) {
      const key = `cat${cIdx}-rew${rIdx}`;
      appState.checked[key] = !appState.checked[key];
      // Activity log
      if (appState.checked[key]) {
        appState.activity.unshift({
          reward: rewardText,
          category: catName,
          time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
        });
      } else {
        const idx = appState.activity.findIndex(
          entry => entry.reward === rewardText && entry.category === catName
        );
        if (idx > -1) appState.activity.splice(idx, 1);
      }
      saveAndRender();
      // Animate bounce
      setTimeout(() => {
        const box = document.querySelector(`[data-cat="${cIdx}"][data-rew="${rIdx}"]`);
        if (box) {
          box.style.transform = "scale(1.13)";
          setTimeout(() => box.style.transform = "", 160);
        }
      }, 0);
    }

    // --- Activity Log ---
    function renderActivityLog() {
      const logDiv = document.getElementById('activityLog');
      logDiv.innerHTML = '';
      appState.activity.slice(0, 7).forEach(entry => {
        const div = document.createElement('div');
        div.className = 'log-entry';
        div.innerHTML = `<span>${entry.category}: ${entry.reward}</span> <span class="log-time">${entry.time}</span>`;
        logDiv.appendChild(div);
      });
      if (!appState.activity.length) {
        logDiv.innerHTML = `<div class="log-entry" style="color:var(--text-secondary);font-style:italic;">No activity yet</div>`;
      }
    }

    // --- Stats, Progress, Mood, and Streak ---
    function saveDailyCount(count) {
      const today = new Date().toISOString().slice(0,10);
      appState.dailyStats[today] = count;
      // Keep only last 14 days
      const keys = Object.keys(appState.dailyStats);
      if (keys.length > 14) {
        keys.sort();
        for(let i=0;i<keys.length-14;i++) delete appState.dailyStats[keys[i]];
      }
    }

    function getWeeklyAverage() {
      const days = Object.keys(appState.dailyStats).slice(-7);
      if (days.length === 0) return 0;
      const total = days.reduce((sum, d) => sum + (appState.dailyStats[d] || 0), 0);
      return Math.round(total / days.length);
    }

    function getStreak() {
      // Count consecutive days from today backwards with at least 1 reward checked
      const days = Object.keys(appState.dailyStats).sort().reverse();
      let streak = 0;
      let day = new Date();
      for (let i = 0; i < days.length; i++) {
        const dayStr = day.toISOString().slice(0,10);
        if (days[i] === dayStr && appState.dailyStats[dayStr] > 0) {
          streak++;
          day.setDate(day.getDate()-1);
        } else if (days[i] === dayStr) {
          break;
        }
      }
      return streak;
    }

    function renderStatsBar() {
      const todayCount = Object.values(appState.checked).filter(Boolean).length;
      document.getElementById('stat-today').textContent = todayCount;
      document.getElementById('stat-week').textContent = getWeeklyAverage();
      document.getElementById('stat-streak').textContent = getStreak();
      document.getElementById('stat-mood').textContent = appState.mood || '-';
      document.getElementById('progress-bar').style.width =
        appState.categories.reduce((s,cat)=>s+cat.rewards.length,0) === 0
        ? "0%" :
        Math.round(todayCount * 100 /
          appState.categories.reduce((s,cat)=>s+cat.rewards.length,0)
        )+"%";
      // Save daily
      saveDailyCount(todayCount);
    }

    // --- Mood Highlight ---
    function renderMood() {
      document.querySelectorAll('.mood-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.dataset.mood === appState.mood);
      });
    }

    // --- Celebration Banner ---
    function renderCelebrate() {
      const total = Object.values(appState.checked).filter(Boolean).length;
      const grand = appState.categories.reduce((s, cat) => s + cat.rewards.length, 0);
      document.getElementById('celebrate').style.display = (total > 0 && total === grand) ? 'block' : 'none';
    }

    // --- Export/Import Data ---
    function exportData() {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appState));
      const a = document.createElement('a');
      a.setAttribute("href", dataStr);
      a.setAttribute("download", "dopamine-tracker-backup.json");
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }
    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const imported = JSON.parse(e.target.result);
          if (imported.categories && imported.checked && imported.activity) {
            appState = imported;
            saveAndRender();
            alert('Import successful!');
          } else {
            alert('Invalid file format.');
          }
        } catch {
          alert('Failed to import file.');
        }
      };
      reader.readAsText(file);
    }

    // --- Save & Render All ---
    function saveAndRender() {
      localStorage.setItem('dopamine-state', JSON.stringify(appState));
      renderCategories();
      renderStatsBar();
      renderActivityLog();
      renderMood();
      renderCelebrate();
    }

    // --- Reset ---
    function resetDaily() {
      if (confirm("Reset all progress for today?")) {
        appState.checked = {};
        appState.activity = [];
        appState.mood = null;
        saveAndRender();
      }
    }

    // --- Initial Render ---
    saveAndRender();
  </script>
</body>
</html>
